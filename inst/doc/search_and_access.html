<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Search and Access Data</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Search and Access Data</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(EDIutils)</span></code></pre></div>
<div id="search" class="section level2">
<h2>Search</h2>
<p>The repository search service is a standard deployment of Apache Solr
and indexes select metadata fields of data packages. Some of the
possible motivations for using the search API include:</p>
<ul>
<li><p>Building a custom search interface that offers some feature not
found in the EDI data portal (e.g. build a query interface where the
search results are always restricted to a particular research
project).</p></li>
<li><p>Building a local data catalog. In this case we are constructing
the query in our program and displaying a table of matching documents
for our local site including things like title, authors, keywords, and
perhaps the abstract.</p></li>
<li><p>Mining data where EML metadata is the data to be mined,
processed, or analyzed in some way.</p></li>
<li><p>Increased efficiency in that using the search API is often faster
than relying on the data portal where the results are displayed in HTML
and paged 10 documents at a time.</p></li>
</ul>
<p>For a list of searchable fields see
<code>search_data_packages()</code>. For more on constructing Solr
queries see the <a href="https://cwiki.apache.org/confluence/display/solr/">Apache Solr
Wiki</a>. For a browser based search experience use the <a href="https://portal.edirepository.org/nis/advancedSearch.jsp">EDI data
portal</a>.</p>
<p>Results can be filtered to include only fields of interest.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Match all documents with keywords &quot;disturbance&quot; and return only their IDs</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">search_data_packages</span>(<span class="at">query =</span> <span class="st">&#39;q=keyword:disturbance&amp;fl=id&#39;</span>)</span></code></pre></div>
<p>When constructing a query note that the 15403 data packages of the <a href="https://lternet.edu/the-ecotrends-project/">ecotrends</a> project
and 10492 data packages of the <a href="https://lternet.edu/lter-remote-sensing-and-geographic-information-system-data/">LTER
Landsat</a> project, can be excluded from the returned results by
including <code>&amp;fq=-scope:(ecotrends+lter-landsat)</code> in the
query string.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Match all documents with keywords &quot;disturbance&quot;, excluding ecotrends and </span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># lter-landsat scopes from the returned results</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">&#39;q=keyword:disturbance&amp;fl=packageid&amp;fq=-scope:(ecotrends+lter-landsat)&#39;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">search_data_packages</span>(query)</span></code></pre></div>
<p>Use wild cards operators to match anything and control the number of
returned results.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Match anything, display all fields, limit to only one document</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">search_data_packages</span>(<span class="at">query =</span> <span class="st">&#39;q=*&amp;fl=*&amp;rows=1&#39;</span>)</span></code></pre></div>
<p>Use scope, keyword, and author fields to get all data packages
belonging to a research site, organization, or author.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Find all FCE LTER data packages, displaying the package id, title, and DOI</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">&#39;q=scope:knb-lter-fce&amp;fl=packageid,title,doi&amp;rows=100&#39;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">search_data_packages</span>(query)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># Query on author</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">&#39;q=author:duane+costa&amp;fq=author:costa&amp;fl=id,title,author,score&#39;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">search_data_packages</span>(query)</span></code></pre></div>
<p>Queries can be complex.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Query on subject &quot;Primary Production&quot; OR subject &quot;plant&quot;. Note that &#39;subject&#39;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># is an aggregation of several other fields containing searchable text: </span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co"># &#39;author&#39;, &#39;organization&#39;, &#39;title&#39;, &#39;keyword&#39;, and &#39;abstract&#39; fields rolled</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># together into a single searchable field.</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;q=subject:(&quot;Primary+Production&quot;)+OR+subject:plant&amp;fq=&#39;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                <span class="st">&#39;-scope:ecotrends&amp;fq=-scope:lter-landsat*&amp;fl=id,packageid,&#39;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>                <span class="st">&#39;title,author,organization,pubdate,coordinates&#39;</span>)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">search_data_packages</span>(query)</span></code></pre></div>
<p>An alternative method for searching and retrieving metadata is the
“list and read” method. It involves listing data package identifiers of
interest, then read the corresponding metadata of those data packages
one at a time, parsing and extracting whatever metadata from them that
you’re interested in searching or doing additional processing on.
Although this sounds like more work than using the search API, and in
fact it generally is, there are some use cases where this might be the
preferred approach. For example this list and read method allows access
to previous versions of a data package, whereas the search API only
provides access to the most recent version, and this method provides
access to all EML content, not just indexed fields.</p>
</div>
<div id="access" class="section level2">
<h2>Access</h2>
<p>The EDI data repository provides open access to archived data as
packages. Packages can be downloaded in .zip format or their individual
data entities downloaded as raw bytes and files. Entities with a common
format can be parsed simply by most readers while more complex formats
need metadata to help with parsing.</p>
<p>Sometimes, it’s valuable to work with the latest version within a
series of data packages to ensure you have the most current data for
your application. To determine the newest data package identifier, you
can utilize the ‘newest’ filter provided by the
<code>list_data_package_revisions()</code> function and append the
returned value to the ‘scope’ and ‘identifier’ parameters.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>scope <span class="ot">=</span> <span class="st">&quot;edi&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>identifier <span class="ot">=</span> <span class="st">&quot;1047&quot;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>revision <span class="ot">=</span> <span class="fu">list_data_package_revisions</span>(scope, identifier, <span class="at">filter =</span> <span class="st">&quot;newest&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">paste</span>(scope, identifier, revision, <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; [1] &quot;edi.1047.2&quot;</span></span></code></pre></div>
<p>However, there are some important considerations when working with
the newest version. For instance, the ‘entityId’ (identifiers for
individual data objects) can change as the data entity evolves, making
it unsuitable for referencing the newest data entity. One workaround is
to use the ‘entityName’, which may remain stable across versions,
although this isn’t always guaranteed. Additionally, be aware that
alterations to the data entity structure, such as changes to data table
and column names, can potentially disrupt your processes. In such cases,
robust messaging and error handling can prove invaluable in workflows
that rely on these data.</p>
<p>For the purposes of this vignette, we will use ‘edi.1047.1’ as our
example.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>packageId <span class="ot">&lt;-</span> <span class="st">&quot;edi.1047.1&quot;</span></span></code></pre></div>
<p>Downloading a data package archive (.zip) requires a data package
ID.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Download data package to path</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">read_data_package_archive</span>(packageId, <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; |=============================================================| 100%</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">dir</span>(<span class="fu">tempdir</span>())</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; [1] &quot;&quot;edi.1047.1.zip&quot;</span></span></code></pre></div>
<p>Downloading an individual data entity requires the entity ID.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># List data entities of the data package</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">read_data_entity_names</span>(packageId)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>res</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt;                           entityId                entityName</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; 1 3abac5f99ecc1585879178a355176f6d        Environmentals.csv</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; 2 f6bfa89b48ced8292840e53567cbf0c8               ByCatch.csv</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; 3 c75642ddccb4301327b4b1a86bdee906               Chinook.csv</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; 4 2c9ee86cc3f3ffc729c5f18bfe0a2a1d             Steelhead.csv</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; 5 785690848dd20f4910637250cdc96819 TrapEfficiencyRelease.csv</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; 6 58b9000439a5671ea7fe13212e889ba5 TrapEfficiencySummary.csv</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; 7 86e61c1a501b7dcf0040d10e009bfd87        TrapOperations.csv</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co"># Download Steelhead.csv in raw bytes. Use the entityName and entityID as keys.</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>entityName <span class="ot">&lt;-</span> <span class="st">&quot;Steelhead.csv&quot;</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>entityId <span class="ot">&lt;-</span> res<span class="sc">$</span>entityId[res<span class="sc">$</span>entityName <span class="sc">==</span> entityName]</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">read_data_entity</span>(packageId, entityId)</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="fu">head</span>(raw)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; [1] ef bb bf 44 61 74</span></span></code></pre></div>
<p>Common formats are easily parsed.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># These data have a common format are simply parsed</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> raw)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>data</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2,926 x 14</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt;    Date   trapVisitID subSiteName catchRawID releaseID commonName </span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      </span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt;  1 1/12/~         326 North Chan~      32123         0 Steelhead ~</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt;  2 1/14/~         336 North Chan~      33980         0 Steelhead ~</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt;  3 1/15/~         337 North Chan~      32683         0 Steelhead ~</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt;  4 1/16/~         339 North Chan~      32971         0 Steelhead ~</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt;  5 1/17/~         341 North Chan~      33104         0 Steelhead ~</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt;  6 1/18/~         342 North Chan~      33304         0 Steelhead ~</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt;  7 1/19/~         343 North Chan~      33432         0 Steelhead ~</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt;  8 1/21/~         349 North Chan~      34083         0 Steelhead ~</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt;  9 1/21/~         349 North Chan~      34084         0 Steelhead ~</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; 10 1/23/~         351 North Chan~      34384         0 Steelhead ~</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; # ... with 2,916 more rows, and 8 more variables:</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; #   lifeStage &lt;chr&gt;, forkLength &lt;dbl&gt;, weight &lt;dbl&gt;, n &lt;dbl&gt;,</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; #   mort &lt;chr&gt;, fishOrigin &lt;chr&gt;, markType &lt;chr&gt;,</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; #   CatchRaw.comments &lt;chr&gt;</span></span></code></pre></div>
<p>Less common formats require metadata for parsing. This metadata is
listed under the “physical” node of a data entities EML.</p>
<p><em>See the <a href="https://CRAN.R-project.org/package=emld">emld</a> library for more
on working with EML as a list or JSON-LD. See the <a href="https://CRAN.R-project.org/package=xml2">xml2</a> library for
working with EML as XML.</em></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Read the same data entity but using the physical metadata</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>eml <span class="ot">&lt;-</span> <span class="fu">read_metadata</span>(packageId)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">read_metadata_entity</span>(packageId, entityId)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>fieldDelimiter <span class="ot">&lt;-</span> <span class="fu">xml_text</span>(<span class="fu">xml_find_first</span>(meta, <span class="st">&quot;.//physical//fieldDelimiter&quot;</span>))</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>numHeaderLines <span class="ot">&lt;-</span> <span class="fu">xml_double</span>(<span class="fu">xml_find_first</span>(meta, <span class="st">&quot;.//physical//numHeaderLines&quot;</span>))</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>data <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="at">file =</span> raw, </span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="at">delim =</span> fieldDelimiter, </span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  <span class="at">skip =</span> numHeaderLines<span class="dv">-1</span>)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>data</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2,926 x 14</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt;    Date   trapVisitID subSiteName catchRawID releaseID commonName </span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      </span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt;  1 1/12/~         326 North Chan~      32123         0 Steelhead ~</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt;  2 1/14/~         336 North Chan~      33980         0 Steelhead ~</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt;  3 1/15/~         337 North Chan~      32683         0 Steelhead ~</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt;  4 1/16/~         339 North Chan~      32971         0 Steelhead ~</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt;  5 1/17/~         341 North Chan~      33104         0 Steelhead ~</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt;  6 1/18/~         342 North Chan~      33304         0 Steelhead ~</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="co">#&gt;  7 1/19/~         343 North Chan~      33432         0 Steelhead ~</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="co">#&gt;  8 1/21/~         349 North Chan~      34083         0 Steelhead ~</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="co">#&gt;  9 1/21/~         349 North Chan~      34084         0 Steelhead ~</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="co">#&gt; 10 1/23/~         351 North Chan~      34384         0 Steelhead ~</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="co">#&gt; # ... with 2,916 more rows, and 8 more variables:</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="co">#&gt; #   lifeStage &lt;chr&gt;, forkLength &lt;dbl&gt;, weight &lt;dbl&gt;, n &lt;dbl&gt;,</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="co">#&gt; #   mort &lt;chr&gt;, fishOrigin &lt;chr&gt;, markType &lt;chr&gt;,</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="co">#&gt; #   CatchRaw.comments &lt;chr&gt;</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
